{% extends "base.html" %}
{% block title %}{{ _('Weekly Report') }} - CostFlow{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-6 fw-bold text-primary">{{ _('Weekly Report') }}</h1>
        <p class="text-secondary">
            {{ _('Performance summary for week') }} {{ week_start.strftime('%d/%m/%Y') }} - {{ week_end.strftime('%d/%m/%Y') }}
        </p>
    </div>
</div>

<!-- Week Selector -->
<div class="row mb-4">
    <div class="col-md-6">
        <form method="GET" action="{{ url_for('reports.weekly_report') }}" class="d-flex gap-2 align-items-center">
            <label for="week_start" class="form-label mb-0 text-nowrap">{{ _('Select week:') }}</label>
            <select name="week_start" id="week_start" class="form-select select2" onchange="this.form.submit()">
                {% for week in weeks %}
                <option value="{{ week.week_start_date.strftime('%Y-%m-%d') }}" {% if week_start and week_start == week.week_start_date %}selected{% endif %}>
                    {{ _('Week') }} {{ week.week_start_date.strftime('%d/%m/%Y') }}
                </option>
                {% else %}
                <option disabled>{{ _('No weeks available') }}</option>
                {% endfor %}
            </select>
        </form>
    </div>
    <div class="col-md-6 text-end">
        <button onclick="window.print()" class="btn btn-outline-secondary">
            <i class="bi bi-printer me-2"></i>{{ _('Print') }}
        </button>
    </div>
</div>

{% if no_data %}
<div class="alert alert-info">
    <i class="bi bi-info-circle me-2"></i>
    {{ _('No data found for selected week') }}
</div>
{% else %}

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h6 class="card-title">{{ _('Revenue') }}</h6>
                <h3 class="mb-0">{{ currency_symbol }}{{ "%.2f"|format(total_revenue) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <h6 class="card-title">{{ _('Prime Costs') }}</h6>
                <small class="text-white-50">{{ _('(Materials + Packaging + Premakes)') }}</small>
                <h3 class="mb-0">{{ currency_symbol }}{{ "%.2f"|format(total_prime_costs) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h6 class="card-title">{{ _('Labor Costs') }}</h6>
                <h3 class="mb-0">{{ currency_symbol }}{{ "%.2f"|format(labor_costs) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h6 class="card-title">{{ _('Net Profit') }}</h6>
                <h3 class="mb-0">{{ currency_symbol }}{{ "%.2f"|format(net_profit) }}</h3>
                <small>{{ "%.1f"|format((net_profit / total_revenue * 100) if total_revenue > 0 else 0) }}%</small>
            </div>
        </div>
    </div>
</div>

<!-- Food Cost Analysis -->
<div class="card mb-4">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-calculator me-2"></i>{{ _('Product Food Cost Analysis (Food Cost)') }}</h5>
        <a href="{{ url_for('reports.monthly_report') }}" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-bar-chart-line me-1"></i>{{ _('Monthly Trends') }}
        </a>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="text-center">
                    <h6 class="text-muted">{{ _('Total Food Cost') }}</h6>
                    <h3 class="text-primary">{{ currency_symbol }}{{ "%.2f"|format(total_food_cost) }}</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <h6 class="text-muted">{{ _('Average Cost per Recipe') }}</h6>
                    <h3 class="text-info">{{ currency_symbol }}{{ "%.2f"|format(avg_food_cost_per_recipe) }}</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <h6 class="text-muted">{{ _('Total Recipes Produced') }}</h6>
                    <h3 class="text-success">{{ total_recipes_produced }}</h3>
                </div>
            </div>
        </div>

        {% if production_details %}
        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>{{ _('Product') }}</th>
                        <th>{{ _('Production Count') }}</th>
                        <th>{{ _('Total Recipes') }}</th>
                        <th>{{ _('Units per Recipe') }}</th>
                        <th>{{ _('Cost per Recipe') }}</th>
                        <th>{{ _('Total Cost') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prod in production_details %}
                    <tr>
                        <td>{{ prod.product_name }}</td>
                        <td>
                            <span class="badge bg-light text-dark border">{{ prod.production_count }}</span>
                        </td>
                        <td class="fw-bold">{{ prod.recipes_produced }}</td>
                        <td>{{ prod.units_per_recipe }}</td>
                        <td>{{ currency_symbol }}{{ "%.2f"|format(prod.cost_per_recipe) }}</td>
                        <td class="fw-bold text-primary">{{ currency_symbol }}{{ "%.2f"|format(prod.total_cost) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if total_revenue > 0 and total_food_cost > 0 %}
        <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle me-2"></i>
            <strong>{{ _('Food Cost Percentage:') }}</strong>
            {{ "%.1f"|format((total_food_cost / total_revenue * 100)) }}%
            {{ _('of revenue') }}
            <small class="text-muted">({{ _('Recommended target: 25-35%%') }})</small>
        </div>
        <div class="alert alert-secondary mt-2">
            <small><i class="bi bi-info-circle me-2"></i>
            {{ _('Food cost includes raw materials, packaging, and premakes for products produced this week.') }}
            </small>
        </div>
        {% endif %}
    </div>
</div>

<!-- Sales by Category -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>{{ _('Sales by Category') }}</h5>
    </div>
    <div class="card-body">
        {% if category_summaries %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Category') }}</th>
                        <th>{{ _('Number of Products') }}</th>
                        <th>{{ _('Quantity Sold') }}</th>
                        <th>{{ _('Waste Quantity') }}</th>
                        <th>{{ _('Revenue') }}</th>
                        <th>{{ _('Prime Costs') }}</th>
                        <th>{{ _('Gross Profit') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cat_name, cat_data in category_summaries.items() %}
                    <tr>
                        <td class="fw-medium">{{ cat_name }}</td>
                        <td>{{ cat_data.products|length }}</td>
                        <td>{{ cat_data.quantity_sold|int }}</td>
                        <td>{{ cat_data.quantity_waste|int }}</td>
                        <td>{{ currency_symbol }}{{ "%.2f"|format(cat_data.revenue) }}</td>
                        <td>{{ currency_symbol }}{{ "%.2f"|format(cat_data.prime_cost) }}</td>
                        <td class="{% if cat_data.revenue - cat_data.prime_cost > 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ currency_symbol }}{{ "%.2f"|format(cat_data.revenue - cat_data.prime_cost) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th>{{ _('Total') }}</th>
                        <th>-</th>
                        <th>{{ category_summaries.values()|sum(attribute='quantity_sold')|int }}</th>
                        <th>{{ category_summaries.values()|sum(attribute='quantity_waste')|int }}</th>
                        <th>{{ currency_symbol }}{{ "%.2f"|format(total_revenue) }}</th>
                        <th>{{ currency_symbol }}{{ "%.2f"|format(total_prime_costs) }}</th>
                        <th>{{ currency_symbol }}{{ "%.2f"|format(total_revenue - total_prime_costs) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
        {% else %}
        <p class="text-muted">{{ _('No sales data by category') }}</p>
        {% endif %}
    </div>
</div>

<!-- Product Sales Details -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>{{ _('Product Sales Details') }}</h5>
    </div>
    <div class="card-body">
        {% if sales_data %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Product') }}</th>
                        <th>{{ _('Category') }}</th>
                        <th>{{ _('Unit Price') }}</th>
                        <th>{{ _('Quantity Sold') }}</th>
                        <th>{{ _('Waste Quantity') }}</th>
                        <th>{{ _('Revenue') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sale in sales_data %}
                    <tr>
                        <td class="fw-medium">{{ sale.name }}</td>
                        <td>{{ sale.category_name or _('No Category') }}</td>
                        <td>{{ currency_symbol }}{{ "%.2f"|format(sale.selling_price_per_unit or 0) }}</td>
                        <td>{{ sale.quantity_sold|int }}</td>
                        <td>{{ sale.quantity_waste|int }}</td>
                        <td>{{ currency_symbol }}{{ "%.2f"|format(sale.revenue) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">{{ _('No product sales data') }}</p>
        {% endif %}
    </div>
</div>

<!-- Premakes Activity -->
{% if premake_report_data %}
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-blender me-2"></i>{{ _('Premakes Activity') }}</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Premake Name') }}</th>
                        <th class="text-center">{{ _('Produced') }}</th>
                        <th class="text-center">{{ _('Used (in products)') }}</th>
                        <th class="text-center">{{ _('In Stock') }}</th>
                        <th class="text-center">{{ _('Cost per Unit (per kg)') }}</th>
                        <th class="text-center">{{ _('Total Production Value') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in premake_report_data %}
                    <tr>
                        <td class="fw-medium">{{ item.name }}</td>
                        <td class="text-center">{{ "%.2f" | format(item.produced) }} {{ item.unit }}</td>
                        <td class="text-center">{{ "%.2f" | format(item.used) }} {{ item.unit }}</td>
                        <td class="text-center fw-bold">{{ "%.2f" | format(item.current_stock) }} {{ item.unit }}</td>
                        <td class="text-center text-muted">{{ currency_symbol }}{{ "%.2f" | format(item.cost_per_unit) }}</td>
                        <td class="text-center fw-bold">{{ currency_symbol }}{{ "%.2f" | format(item.total_value_produced) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Labor Breakdown -->
{% if labor_entries %}
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-people me-2"></i>{{ _('Labor Cost Details') }}</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Employee') }}</th>
                        <th>{{ _('Entry Count') }}</th>
                        <th>{{ _('Total Hours') }}</th>
                        <th>{{ _('Total Cost') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in labor_entries %}
                    <tr>
                        <td class="fw-medium">{{ entry.employee_name }}</td>
                        <td>
                            <span class="badge bg-light text-dark border">{{ entry.entry_count }}</span>
                        </td>
                        <td class="fw-bold">{{ "%.2f"|format(entry.hours) }}</td>
                        <td class="fw-bold text-primary">{{ currency_symbol }}{{ "%.2f"|format(entry.cost) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th>{{ _('Total') }}</th>
                        <th></th>
                        <th class="fw-bold">{{ "%.2f"|format(labor_entries|sum(attribute='hours')) }}</th>
                        <th class="fw-bold text-primary">{{ currency_symbol }}{{ "%.2f"|format(labor_costs) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Stock Discrepancies -->
{% if stock_audits %}
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>{{ _('Stock Discrepancies Found This Week') }}</h5>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-6">
                <h6>{{ _('Discrepancy Summary') }}</h6>
                <ul class="list-unstyled">
                    <li><strong>{{ _('Number of Counts:') }}</strong> {{ stock_audit_count }}</li>
                    <li class="{% if total_stock_variance_cost < 0 %}text-danger{% else %}text-success{% endif %}">
                        <strong>{{ _('Total Monetary Value:') }}</strong> {{ currency_symbol }}{{ "%.2f"|format(total_stock_variance_cost) }}
                    </li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>{{ _('Discrepancies by Category') }}</h6>
                {% if audit_by_category %}
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>{{ _('Category') }}</th>
                            <th>{{ _('Counts') }}</th>
                            <th>{{ _('Monetary Value') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cat_name, cat_data in audit_by_category.items() %}
                        <tr>
                            <td>{{ cat_name }}</td>
                            <td>{{ cat_data.count }}</td>
                            <td class="{% if cat_data.variance_cost < 0 %}text-danger{% endif %}">
                                {{ currency_symbol }}{{ "%.2f"|format(cat_data.variance_cost) }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

        {% if total_stock_variance_cost != 0 %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>{{ _('Adjusted Profit (including stock discrepancies):') }}</strong>
            {{ currency_symbol }}{{ "%.2f"|format(adjusted_profit) }}
            <small class="text-muted">({{ _('instead of') }} {{ currency_symbol }}{{ "%.2f"|format(net_profit) }})</small>
        </div>
        {% endif %}

        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>{{ _('Date') }}</th>
                        <th>{{ _('Raw Material') }}</th>
                        <th>{{ _('Difference') }}</th>
                        <th>{{ _('Monetary Value') }}</th>
                        <th>{{ _('Counter') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for audit in stock_audits[:5] %}
                    <tr>
                        <td>{{ audit.audit_date.strftime('%d/%m %H:%M') }}</td>
                        <td>{{ audit.raw_material.name if audit.raw_material else _('Unknown') }}</td>
                        <td class="{% if audit.variance < 0 %}text-danger{% endif %}">
                            {{ "%.1f"|format(audit.variance) }}
                        </td>
                        <td class="{% if audit.variance_cost < 0 %}text-danger{% endif %}">
                            {{ currency_symbol }}{{ "%.2f"|format(audit.variance_cost) }}
                        </td>
                        <td>{{ audit.auditor_name or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if stock_audits|length > 5 %}
            <p class="text-muted small">{{ _('Showing last 5 counts out of') }} {{ stock_audits|length }}</p>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Key Insights -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>{{ _('Key Insights') }}</h5>
    </div>
    <div class="card-body">
        <ul class="list-unstyled mb-0">
            {% if category_summaries %}
                {% set best_category = category_summaries.items()|sort(attribute='1.revenue', reverse=True)|first %}
                {% if best_category %}
                <li class="mb-2">
                    <i class="bi bi-star-fill text-warning me-2"></i>
                    {{ _('Leading category:') }} <strong>{{ best_category[0] }}</strong> {{ _('with revenue of') }} {{ currency_symbol }}{{ "%.2f"|format(best_category[1].revenue) }}
                </li>
                {% endif %}
            {% endif %}

            {% if sales_data %}
                {% set best_product = sales_data|sort(attribute='revenue', reverse=True)|first %}
                {% if best_product %}
                <li class="mb-2">
                    <i class="bi bi-trophy-fill text-success me-2"></i>
                    {{ _('Best-selling product:') }} <strong>{{ best_product.name }}</strong> {{ _('with revenue of') }} {{ currency_symbol }}{{ "%.2f"|format(best_product.revenue) }}
                </li>
                {% endif %}
            {% endif %}

            <li class="mb-2">
                <i class="bi bi-graph-up text-info me-2"></i>
                {{ _('Weekly profit margin:') }} <strong>{{ "%.1f"|format((net_profit / total_revenue * 100) if total_revenue > 0 else 0) }}%</strong>
            </li>

            {% if best_margin_product %}
            <li class="mb-2">
                <i class="bi bi-award-fill text-success me-2"></i>
                {{ _('Product with highest profitability:') }} <strong>{{ best_margin_product.name }}</strong> {{ _('with profit margin of') }} {{ "%.1f"|format(best_margin_product.profit_margin_pct) }}%
            </li>
            {% endif %}

            {% if worst_margin_product %}
            <li class="mb-2 {% if worst_margin_product.profit_margin_pct < 20 %}text-danger{% endif %}">
                <i class="bi bi-exclamation-circle{% if worst_margin_product.profit_margin_pct < 20 %}-fill text-danger{% else %} text-warning{% endif %} me-2"></i>
                {{ _('Product with lowest profitability:') }} <strong>{{ worst_margin_product.name }}</strong> {{ _('with profit margin of') }} {{ "%.1f"|format(worst_margin_product.profit_margin_pct) }}%
                {% if worst_margin_product.profit_margin_pct < 20 %}
                <span class="badge bg-danger">{{ _('Needs review') }}</span>
                {% endif %}
            </li>
            {% endif %}

            {% if highest_profit_product %}
            <li class="mb-2">
                <i class="bi bi-cash-coin text-success me-2"></i>
                {{ _('Product with highest profit contribution:') }} <strong>{{ highest_profit_product.name }}</strong> {{ _('with total profit of') }} {{ currency_symbol }}{{ "%.2f"|format(highest_profit_product.profit_per_unit * (highest_profit_product.quantity_sold or 0)) }}
            </li>
            {% endif %}

            {% if overall_waste_pct > 0 %}
            <li class="mb-2">
                <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                {{ _('Overall waste percentage:') }} <strong>{{ "%.1f"|format(overall_waste_pct) }}%</strong>
                ({{ _('Cost:') }} {{ currency_symbol }}{{ "%.2f"|format(total_waste_cost) }})
            </li>
            {% endif %}
        </ul>
    </div>
</div>

<!-- Waste Analysis -->
{% if waste_details %}
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-trash me-2"></i>{{ _('Waste Analysis') }}</h5>
    </div>
    <div class="card-body">
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h6>{{ _('Total Waste') }}</h6>
                        <h3>{{ (category_summaries.values()|sum(attribute='quantity_waste'))|int }} {{ _('Units') }}</h3>
                        <small>{{ "%.1f"|format(overall_waste_pct) }}% {{ _('of production') }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-danger text-white">
                    <div class="card-body text-center">
                        <h6>{{ _('Waste Cost') }}</h6>
                        <h3>{{ currency_symbol }}{{ "%.2f"|format(total_waste_cost) }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h6>{{ _('Impact on Profit') }}</h6>
                        <h3>{{ "%.1f"|format((total_waste_cost / total_revenue * 100) if total_revenue > 0 else 0) }}%</h3>
                        <small>{{ _('of revenue') }}</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Waste by Product -->
        <h6 class="mb-3">{{ _('Waste by Product') }}</h6>
        <div class="table-responsive mb-4">
            <table class="table table-hover table-sm">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Product') }}</th>
                        <th>{{ _('Category') }}</th>
                        <th class="text-center">{{ _('Sold') }}</th>
                        <th class="text-center">{{ _('Waste') }}</th>
                        <th class="text-center">{{ _('Waste %') }}</th>
                        <th class="text-end">{{ _('Waste Cost') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in waste_details[:10] %}
                    <tr {% if item.waste_pct > 15 %}class="table-danger"{% elif item.waste_pct > 10 %}class="table-warning"{% endif %}>
                        <td class="fw-medium">{{ item.product_name }}</td>
                        <td>{{ item.category_name }}</td>
                        <td class="text-center">{{ item.quantity_sold|int }}</td>
                        <td class="text-center">{{ item.quantity_waste|int }}</td>
                        <td class="text-center">
                            <span class="badge {% if item.waste_pct > 15 %}bg-danger{% elif item.waste_pct > 10 %}bg-warning{% else %}bg-success{% endif %}">
                                {{ "%.1f"|format(item.waste_pct) }}%
                            </span>
                        </td>
                        <td class="text-end text-danger fw-bold">{{ currency_symbol }}{{ "%.2f"|format(item.waste_cost) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if waste_details|length > 10 %}
            <p class="text-muted small">{{ _('Showing top 10 products with highest waste cost') }}</p>
            {% endif %}
        </div>

        <!-- Waste by Category -->
        <h6 class="mb-3">{{ _('Waste by Category') }}</h6>
        <div class="table-responsive">
            <table class="table table-sm">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Category') }}</th>
                        <th class="text-center">{{ _('Waste Quantity') }}</th>
                        <th class="text-center">{{ _('Waste %') }}</th>
                        <th class="text-end">{{ _('Total Cost') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cat_name, cat_data in waste_by_category.items() %}
                    <tr>
                        <td class="fw-medium">{{ cat_name }}</td>
                        <td class="text-center">{{ cat_data.total_waste_qty|int }}</td>
                        <td class="text-center">
                            <span class="badge {% if cat_data.waste_pct > 15 %}bg-danger{% elif cat_data.waste_pct > 10 %}bg-warning{% else %}bg-success{% endif %}">
                                {{ "%.1f"|format(cat_data.waste_pct) }}%
                            </span>
                        </td>
                        <td class="text-end">{{ currency_symbol }}{{ "%.2f"|format(cat_data.total_waste_cost) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% endif %}

<style>
@media print {
    .navbar, .btn, form {
        display: none !important;
    }
    .card {
        break-inside: avoid;
    }
}
</style>

{% endblock %}